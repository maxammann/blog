---
layout: post
title: "tlspuffin: Symbolic Trace of CVE-2021-3449"
date: 2021-06-04
slug: tlspuffin-cve-2021-3449
draft: false

katex: true
hypothesis: true

keywords: []
categories: [research-blog]
---

[CVE-2021-3449](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-3449) is not caused by a flaw of the protocol itself, but because of an implementation issue. To demonstrate that tlspffin is able to find this vulnerability we encode the attack as a symbolic trace.


## Input Step #0

{{< resourceFigure "seed_cve_2021_3449_0.svg" >}}
A term which evaluates to a `ClientHello` message and is sent to Agent 1 which is a TLS server.
{{< />}}

## Output Step #1

We tell Agent 1 to output messages and annotate them with the observed ID $(0,x)$, where $x$ is the index of the message sent during this step.

## Input Step #2

{{< resourceFigure "seed_cve_2021_3449_2.svg" >}}
A term which evaluates to a `ClientKeyExchange` message and uses binary data which was observed at `(0,2)`.
{{< />}}

## Input Step #3

{{< resourceFigure "seed_cve_2021_3449_3.svg" >}}
A term which evaluates a `ChangeCipherSpec` message as traffic is encrypted from now on.
{{< />}}

## Input Step #4

{{< resourceFigure "seed_cve_2021_3449_4.svg" >}}
A term which evaluates an encrypted `Finished` message. It uses a signed transcript of previously sent messages, including the initial `ClientHello`.
{{< />}}


## Input Step #5

{{< resourceFigure "seed_cve_2021_3449_5.svg" >}}
A term which evaluates an encrypted `ClientHello` with a renegotiation extension which includes the signed verification data of the last `Finished` message.
{{< />}}

## The Big Picture

The above terms are quite hard to read as they contain cloned sub-terms. By clustering the terms and reusing sub-terms we can make it visually clear that sub-terms are indeed reused. 

{{< resourceFigure "seed_cve_2021_3449_all.svg" >}}
All steps in a single clustered directed graph.
{{< />}}


Note that the above trace does not use a client agent. Is uses a single agent which uses the OpenSSL library and acts as a server. After executing the above trace OpenSSL crashes with a segementation fault.

